<p class="pageTitle">Edit Record</p>

<%= field_set_tag :Response do %>
	<p>Date/Time: <%= @survey_response.created_at.strftime("%m/%d/%Y - %T") %></p>

	<p>Page URL: <%= @survey_response.page_url %></p>

	<% @survey_response.display_field_values.includes(:display_field).where("display_fields.editable = ?", false).each do |dfv| %>
		<p>
			<%= dfv.display_field.name %>:
			<%= dfv.value %>
		</p>
	<% end %>
<% end %>

<%= form_for @survey_response do |f| %>

	<% @survey_response.display_field_values.includes(:display_field).where("display_fields.editable = ?", true).each_with_index do |display_field_value, i| %>
		<%= f.fields_for :display_field_values, display_field_value do |dfv| %>
			<% df = dfv.object.display_field %>
			<p>
			<%= df.name %>:
			<% if df.editable? %>
				<% if df.type == "DisplayFieldText" %>
					<%= dfv.text_field :value %>
				<% elsif df.type == "DisplayFieldChoiceSingle" %>
					<%= dfv.select :value, df.choices.split %>
				<% elsif df.type == "DisplayFieldChoiceMultiselect" %>
			  		<% df.choices.split.each_with_index do |val, index| %>
			  			<%= check_box_tag "survey_response[display_field_values_attributes][#{i}][value_array][]", val, (dfv.object.value and dfv.object.value.include?(val)), {:id => "survey_response[display_field_values_attributes][#{i}][value_array][]"} %><%= val %>
			  		<% end %>
			  		<%= dfv.hidden_field :id, :value => dfv.object.id %>
					<!-- <input type="hidden" value="<%= df.id %>" name="survey_response[display_field_values_attributes][<%= dfv.object.id %>][display_field_id]" id="survey_response_display_field_values_attributes_<%= dfv.object.id %>_display_field_id"> -->

				<% end %>
			<% else %>
				<%= dfv.object.value %>
			<% end %>
			</p>
		<% end %>
	<% end %>

	<%= f.submit "Save Changes" %>	| <%= link_to "Cancel", survey_responses_path(:survey_id => @survey_response.survey_version.survey_id, :survey_version_id => @survey_response.survey_version_id) %>
<% end %>

<h1>All Surveys</h1>
<% flash.each do |msg, name| %>
	<%= flash[name] %>
<% end %>
<%= flash_messages(flash) %>

<div id="surveySearch">
	<%= form_tag surveys_path,:method => :get, :id => "searchSurveyForm" do %>
		<%= label_tag :q, "Search Surveys" %>
		<%= text_field_tag :q, params[:q] %>
		<%= link_to "View all surveys", surveys_path, :class=>"manage" %>
	<% end %>
</div>

<div class="page-nav">
	<%= link_to 'New Survey', new_survey_path, :class => "newlink" %>
</div>

<table id="surveyTable">
  <tr>
  	<th class="col1" scope="col">Edit</th>
  	<th class="col2" scope="col">Ver.</th>
    <th class="col3" scope="col">Report</th>
    <th class="col4" scope="col"><%= sortable "Survey" %> <span class="notation">(click to view responses)</span></th>
    <th class="col5" scope="col">Description</th>
    <th class="col6" scope="col">Type</th>
    <th class="col7" scope="col">Site</th>
    <th class="col8" scope="col"></th>
  </tr>

<% @surveys.each do |survey| %>
  <% latest_version = survey.published_version.try(:id) || survey.survey_versions.last.id %>
  <tr class="<%= cycle('gray','white') %>">
    <td class="col1"><%= link_to image_tag('edit.png', :alt=>"edit"), edit_survey_path(survey) %></td>
    <td class="col2"><%= link_to image_tag('version.png', :alt=>"view versions"), survey_survey_versions_path(survey)%></td>
    <td class="col3"><%= link_to "[X]", reporting_survey_survey_version_path(:id => latest_version, :survey_id => survey.id) %></td>
    <td class="col4"><%= link_to survey.name, survey_responses_path(:survey_version_id => latest_version, :survey_id => survey.id) %></td>
    <td class="col5"><%= survey.description %></td>
    <td class="col6"><%= survey.survey_type.name.titleize %></td>
		<td class="col7"><%= survey.site.name %></td>
    <td class="col8"><%= link_to image_tag("delete.png", :alt=>"Delete"), survey, :confirm => 'Are you sure?', :method => :delete, :class=>"deleteLink" %></td>
  </tr>
<% end %>
</table>

<%= paginate @surveys %>

<div class="page-nav">
	<%= link_to 'New Survey', new_survey_path, :class => "newlink" %>
</div>

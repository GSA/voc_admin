<% javascript 'survey.js' %>

<% if @survey_version.nil? %>
	<p>Could not find version <%= params[:version] %></p>
	<%= link_to "View all", survey_path(@survey) %>
<% else %>
	<p id="notice"><%= notice %></p>

	<p>
	  <b>Name:</b>
	  <%= @survey.name %>
	</p>

	<p>
	  <b>Description:</b>
	  <%= @survey.description %>
	</p>

	<%= form_tag url_for(:controller => "survey_responses", :action => "create") do %>
		<% for page in @survey_version.pages %>
			<div class="<%= page.number == 1 ? 'current_page' : 'hidden_page' %>" id="page_<%=page.number%>">
				<%= hidden_field_tag "survey_version_id", @survey_version.id %>
				<ol>
				<% page.survey_elements.order("element_order asc").each_with_index do |element, index| %>
					<li>
						
						<% unless element.assetable_type == "Asset" %>
							<%= hidden_field_tag "response[raw_responses_attributes][#{index}][question_id]", element.assetable.question_content.id %>
							<%= hidden_field_tag "response[raw_responses_attributes][#{index}][survey_version_id]", @survey_version.id%>
							<%= element.assetable.question_content.statement %>
							<%= "*" if element.assetable.question_content.required%><br/>
							<% if element.assetable_type == "ChoiceQuestion" %>
								<% if element.assetable.answer_type == ChoiceAnswer::RADIO %>
									<% for answer in element.assetable.choice_answers %>
										<%= radio_button_tag "response[raw_responses_attributes][#{index}][answer]", answer.id, :onclick => (element.assetable.question_content.flow_control ? "set_next_page(this, #{answer.next_page_id})" : "") %><%= answer.answer%><br/>
									<% end -%>
								<% elsif element.assetable.answer_type == ChoiceAnswer::DROPDOWN %>
								  <%= select_tag "response[raw_responses_attributes][#{index}][answer]", options_from_collection_for_select(element.assetable.choice_answers, "id", "answer"),
								 				:onchange => (element.assetable.question_content.flow_control ? "set_next_page(this, #{answer.next_page_id})" : "")%>
								<% elsif element.assetable.answer_type == ChoiceAnswer::MULTISELECT %>
								  <%= select_tag "response[raw_responses_attributes][#{index}][answer][]", options_from_collection_for_select(element.assetable.choice_answers, "id", "answer"), :multiple => true,
								 				:onclick => (element.assetable.question_content.flow_control ? "set_next_page(this, #{answer.next_page_id})" : "")%>
								<% elsif element.assetable.answer_type == ChoiceAnswer::CHECKBOX %>
								  <% for answer in element.assetable.choice_answers %>
									  <%= check_box_tag "response[raw_responses_attributes][#{index}][answer][]", answer.id, false, :id => "answer_#{answer.id}", :onclick => (element.assetable.question_content.flow_control ? "set_next_page(this, #{answer.next_page_id})" : "") %>
										<%= label_tag "answer_#{answer.id}", answer.answer %>
									<% end -%>
								<% end %>
							<% elsif element.assetable_type == "TextQuestion" %>
								<% if element.assetable.answer_type == "field" %>
									<%= text_field_tag "response[raw_responses_attributes][#{index}][answer]", nil, :class => "text_question_field" %>
								<% elsif element.assetable.answer_type == "area" %>
									<%= text_area_tag "response[raw_responses_attributes][#{index}][answer]", nil, :class => "text_question_area"%>
								<% end -%>
							<% end -%>	
						<% else %>
              <%= element.assetable.snippet.html_safe%>
						<% end %>			
					</li>
				<% end %>
				</ol>
				
				<%= link_to_function "Previous Page", "prev_page(#{page.number})" unless page.number == 1 %>
				<%= link_to_function "Next Page", "next_page(#{page.number})" unless page.number == @survey_version.pages.count %>
				<%= submit_tag "Submit Survey" if page.number == @survey_version.pages.count %>
				
				
			</div> <!-- close page div -->
		<% end -%>
	<% end -%>
<% end -%>
<% if survey_version.errors.any? %>
  <h3>There were errors updating the survey</h3>
<% end -%>

<% survey_version.pages.includes(:survey_elements => :assetable).order("pages.page_number asc").each do |page| %>
	<%= render 'shared/add_element_links', :survey_version => survey_version %>
	<div class="page" id="page_<%=page.page_number%>">
		<span class="copyBold">Page <%= page.page_number %></span>
		<%= page_management_links(survey_version.survey, survey_version, page) %>
		<div>
			<%= label_tag :next_page, "Next Page: " %>
			<%= select_tag :next_page, options_from_collection_for_select(Page.where(:survey_version_id => page.survey_version_id).where("pages.page_number > ?", page.page_number).order(:page_number), :id, :page_number, :selected => page.next_page_id),
			    :id => nil, :class => "NextPageSelect", "data-url" => survey_survey_version_page_path(page.survey_version.survey, page.survey_version, page), :disabled => (Page.where(:survey_version_id => page.survey_version_id).where("pages.page_number > ?", page.page_number).empty? || page.next_page_id.nil? ? "disabled" : nil) %>
      <%= check_box_tag :page_level_flow_control, true, page.next_page_id.present?, :id => nil, :class => "page_level_flow_control" %>
      <%= label_tag :page_level_flow_control, "Enable Page Flow Control" %>
		</div>
		<ul class="outter">
		<% question_number = 0 %>
		<% for element in page.survey_elements.order(:element_order) %>
			
			<li class="outter">
				<% if element.assetable_type != 'Asset'  %>
					<% question_number =+ question_number + 1  %>
					<%= "#{question_number}." %>
				<% end %>
				<span class="survey_element" id="element_<%= element.element_order%>"><%= element.assetable.statement %>
				<%= "*" if element.assetable.try(:required) %> (<%= element.assetable.answer_type %>)</span>
				<%= element_management_links(survey_version.survey, survey_version, element)%>
				<% if element.assetable_type == "ChoiceQuestion" %>
						<ol class="inner">
							<% for answer in element.assetable.choice_answers %>
							<li class="inner"><%= answer.answer %></li>
							<% end -%>
						</ol>
				<% elsif element.assetable_type == "MatrixQuestion" %>
						<table>
							<tr>
								<th></th>
								<% for column_header in element.assetable.column_headers do  %>
								 <th><%= column_header %></th>
								<% end -%>
							</tr>
							<% for row_header in element.assetable.rows do %>
							  <tr>
							  	<td><%= row_header.question_content.statement%><%= "*" if row_header.question_content.required? %></td>
									<% row_header.choice_answers.each do |a| %>
									  <td><%= radio_button_tag "empty", a.answer, false, :disabled => true %></td>
									<% end %>
							  </tr>
							<% end -%>
						</table>
				<% end # close the if statements %>	
				
			</li>		
		<% end # close the for loop %>
		</ul>
	</div>
	
<% end %>

<%= render 'shared/add_element_links', :survey_version => survey_version %>


